<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- SEO includes -->
        
<link href="/en/atom.xml" rel="alternate" title="Guillermo Garron" type="application/atom+xml" />


        <link rel="canonical" href="http://www.garron.me/en/linux/email-fetchmail-procmail-postfix.html" />
        
<meta name="robots" content="noodp, noydir" />


<meta name="description" content="How to collect email from multiple accounts and clasify it, and resend to a new account or mailbox using Fetchmail, Procmail and Postfix" />

        <!-- End SEO includes -->
        <title>Classify Email with Fetchmail, Procmail and Postfix</title>
        <!-- <link rel="stylesheet" href="/foundation/css/foundation.css" /> -->
        <link rel="stylesheet" href="//cdn.jsdelivr.net/foundation/5.5.1/css/foundation.min.css" />
        <link rel="stylesheet" href="/foundation/css/app.css">
        <link href='http://fonts.googleapis.com/css?family=Josefin+Slab|Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/webfonts/ss-social-circle.css" type="text/css">
        <!-- <link href="/bootstrap/css/magnific-popup.css" rel="stylesheet"> -->
        <link href="//cdn.jsdelivr.net/jquery.magnific-popup/1.0.0/magnific-popup.css" rel="stylesheet">
        <!-- Twitter cards -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@ggarron">
        <meta name="twitter:creator" content="@ggarron">
        <meta name="twitter:title" content="Classify Email with Fetchmail, Procmail and Postfix">
        <meta name="twitter:description" content="How to collect email from multiple accounts and clasify it, and resend to a new account or mailbox using Fetchmail, Procmail and Postfix">
        <!-- End Twitter Cards -->
        <!-- FB property -->
        <meta property="fb:admins" content="613797474" />
        <!-- End FB Property -->
        <!-- <script src="/foundation/js/vendor/modernizr.js"></script> -->
        <script src="//cdn.jsdelivr.net/foundation/5.5.1/js/vendor/modernizr.js"></script>
    </head>
    <body>
        
        
        <div class="row">
    <div class="contain-to-grid sticky"> 
        <nav class="top-bar" data-topbar role="navigation" data-options="sticky_on: large">
            <ul class="title-area">
                <li class="name">
                    <h1><a href="/en/">Home</a></h1>
                </li>
                <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
            </ul>
            <section class="top-bar-section">
                <ul class="left">
                    <li><a href="/en/linux/">Linux</a></li>
                    <li><a href="/en/mac/">Mac</a></li>
                    <li><a href="/en/bits/">Tips</a></li>
                    <li><a href="/en/tech/">Tech</a></li>
                    <li><a href="/en/articles/">Articles</a></li>
                    <li><a href="/en/blog/">Blog</a></li>
                    <li><a href="/en/food/">Food</a></li>
                    <li><a href="/en/pictures/">Photos</a></li>
                    <li><a href="/en/projects/">Projects</a></li>
                    <li><a href="/en/web-design/">Web Designg</a></li>
                </ul>
            </section>
        </nav> 
    </div>
</div>
<div class="row">
    <div class="large-12 columns">
        <hr>
        <p>Get updates via: <a href="/en/atom.xml" class="ss-icon ss-social-circle">rss</a> | <a href="http://twitter.com/ggarron" class="ss-icon ss-social-circle">twitter</a> | <a href="http://feedburner.google.com/fb/a/mailverify?uri=GuillermoGarronMainSite&amp;loc=en_US" class="ss-icon ss-social-circle">email</a> | <a href="https://plus.google.com/u/0/115745027821234071812" class="ss-icon ss-social-circle">google+</a></p>
        <ul class="breadcrumbs">
            
            <li><a href="/index.html">Geeking</a>
            <li class="divider">&gt;</li>
            
            <li><a href="/en/index.html">Tech Blog</a>
            <li class="divider">&gt;</li>
            
            <li><a href="/en/linux/index.html">GNU Linux</a>
            <li class="divider">&gt;</li>
            
            <li class="active">Classify Email with Fetchmail, Procmail and Postfix</li>
        </ul>
    </div>
</div>
<div class="row">
    <div class="small-12 large-9 large-centered medium-9 medium-centered columns">
        <h3><a href="/en/linux/email-fetchmail-procmail-postfix.html">Classify Email with Fetchmail, Procmail and Postfix</a></h3>
<h6>Written by <a href="/en/about.html">Guillermo Garron</a> .</h6>
<h6>Date: 2014-09-07 16:30:35 -0400</h6>

        <hr>
        <p><small>Tags: <a href="/en/tag/tutorial.html">tutorial</a>,</small></p>

<hr>
<h3 id="connecting-email-accounts-using-fetchmail-and-postfix">Connecting Email Accounts Using Fetchmail and Postfix</h3>

<p>I know that most email providers have to option to connect accounts, so your main account can collect emails from all others using POP protocol, so you can have all your email concentrated in just one account.</p>

<p>That is not the way I do it, I use Fetchmail and Postfix on an Debian server to do the job. I know there is no reason to do it that way, but as people likes to play soccer I like to work with servers (And play soccer).</p>

<p>Here is what you need:</p>

<ul>
  <li>A Linux server that is online all time (I prefer Ubuntu or Debian)</li>
  <li>Fetchmail install on that server to collect emails</li>
  <li>Postfix to send collected emails to your main account</li>
</ul>

<p>I am using a Debian server on <a href="https://www.digitalocean.com/?refcode=e00a30198abe">Digital Ocean</a> (affiliate link)</p>

<p><strong>Fetchmail Setup</strong></p>

<p>These are the contents on <em>~/.fetchmailrc</em></p>

<pre><code>set no bouncemail
defaults:
  antispam -1 
  batchlimit 100
poll pop.gmail.com port 995 with protocol pop3
user account1@domain password password is user
ssl
sslproto SSL3
fetchall
keep
no rewrite
mda "/usr/bin/procmail -f %F -d %T";

poll pop.gmail.com port 995 with protocol pop3
user account2@gmail.com password passed is user
ssl
sslproto SSL3
fetchall
keep
no rewrite
mda "/usr/bin/procmail -f %F -d %T";
</code></pre>

<p>As you can see I am polling email from a Google Apps account and a Gmail account, and passing them to <code>procmail</code></p>

<p><strong>Procmail Setup</strong></p>

<p>These are the contents of <em>~/.procmailrc</em></p>

<pre><code>:0
	* .*
{
    #:0 c
    #$DEFAULT

    :0 
    !user@domain
}
</code></pre>

<p>This just instructs Procmail to send all collected email to the user@domain address. You can of course uncomment the two commented lines to have a local copy of all collected emails. I do not want that. Check out this great <a href="http://www.panix.com/~elflord/unix/procmail.html#procmailrc">Procmail Guide</a></p>

<p><strong>Postfix Setup</strong></p>

<p>Finally, somebody has to take care of sending all collected emails to the main account. That is going to be postfix. Debian comes with Exim as default, but as soon as you install Postfix, Exim is uninstalled.</p>

<pre><code>apt-get install postfix
</code></pre>

<p>And the <code>/etc/postfix/main.cf</code> file has this:</p>

<pre><code>alias_database = hash:/etc/aliases
alias_maps = hash:/etc/aliases
append_dot_mydomain = no
biff = no
config_directory = /etc/postfix
home_mailbox = Maildir/
inet_interfaces = all
mailbox_command =
mailbox_size_limit = 0
mydestination = your_domain, wordpress, localhost.localdomain, localhost
myhostname = servername.domain
mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128
myorigin = your_domain_here
readme_directory = no
recipient_delimiter = +
relay_domains = localhost
relayhost =
smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache
smtpd_banner = $myhostname ESMTP $mail_name (Debian/GNU)
smtpd_helo_restrictions = reject_invalid_helo_hostname, reject_non_fqdn_helo_hostname, reject_unknown_helo_hostname
smtpd_recipient_restrictions = reject_invalid_hostname, reject_unknown_recipient_domain, reject_unauth_destination, reject_rbl_client sbl.spamhaus.org, permit
smtpd_tls_cert_file = /etc/ssl/certs/ssl-cert-snakeoil.pem
smtpd_tls_key_file = /etc/ssl/private/ssl-cert-snakeoil.key
smtpd_tls_session_cache_database = btree:${data_directory}	smtpd_scache
smtpd_use_tls = yes
</code></pre>

<p>With this configuration, it will send emails by itself, I mean it is not configured to send emails through a SmartHost.</p>

<p>If that is what you want you can read <a href="http://www.garron.me/en/mac/postfix-relay-gmail-mac-os-x-local-smtp.html">here for Postfix</a> and <a href="http://www.garron.me/en/go2linux/sendmail-exim-smarthost.html">Here for Exim or Sendmail</a></p>


<hr>
<a href="http://www.garron.me/en/linux/email-fetchmail-procmail-postfix.html">permalink</a>
<hr>
<p>If you enjoyed the article, please share it</a>
<p><a class="ss-icon ss-social-circle" href="http://twitter.com/intent/tweet?url=http://www.garron.me/en/linux/email-fetchmail-procmail-postfix.html&text=Classify Email with Fetchmail, Procmail and Postfix&via=ggarron">twitter</a> | <a class="ss-icon ss-social-circle" href="http://facebook.com/sharer.php?u=http://www.garron.me/en/linux/email-fetchmail-procmail-postfix.html">facebook</a> | <a class="ss-icon ss-social-circle" href="https://plus.google.com/share?url=http%3A%2F%2Fwww.garron.me/en/linux/email-fetchmail-procmail-postfix.html">google+</a> | <a class="ss-icon ss-social-circle" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.garron.me/en/linux/email-fetchmail-procmail-postfix.html">linkedin</a> | <a href="mailto:?Subject=Classify Email with Fetchmail, Procmail and Postfix&Body=http://www.garron.me/en/linux/email-fetchmail-procmail-postfix.html" class="ss-icon ss-social-circle">email</a> | <a href="http://reddit.com/submit?url=http://www.garron.me/en/linux/email-fetchmail-procmail-postfix.html&title=Classify Email with Fetchmail, Procmail and Postfix" class="ss-icon ss-social-circle">reddit</a></p>

<hr>
<h4>You may want to subscribe to my newsletter</h4>
<p>If you want to receive articles similar to this every month sign in to our Newsletter and joing other 2.000 readers</p>
<p>You can see an example of what is going to be sent to you <a href="/en/tag/tutorial.html">here</a></p>
<form class="all-centered" action="https://tinyletter.com/linux" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/linux', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true"><p><label for="tlemail">Please enter your email in the box below</label></p><p><input type="text" style="width:140px" name="email" id="tlemail" /></p><input type="hidden" value="1" name="embed"/><input type="submit" value="Subscribe" /><p><a href="https://tinyletter.com" target="_blank">powered by TinyLetter</a></p></form>


<hr>
<!-- <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'garronblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> -->


    </div>
</div>
      
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- <script src="/foundation/js/vendor/jquery.js"></script> -->
        <!-- <script src="/foundation/js/foundation.min.js"></script> -->
        <script src="//cdn.jsdelivr.net/foundation/5.5.1/js/foundation.min.js"></script>
        <!-- <script src="/foundation/js/rainbow.min.js"></script> -->
        <script src="//cdn.jsdelivr.net/rainbow/1.1.9/rainbow.min.js"></script>
        <!-- <script src="/bootstrap/js/magnific-popup.js"></script> -->
        <script src="//cdn.jsdelivr.net/jquery.magnific-popup/1.0.0/jquery.magnific-popup.min.js"></script>
        <!-- To start magnific popup -->
        <script src="/bootstrap/js/custom.js"></script>
        <script>
          $(document).foundation();
        </script>
        <!-- Analytics -->
        <!-- <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1514170-11']);
  _gaq.push(['_setDomainName', 'www.garron.me']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>    -->
        <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.go2linux.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src='http://d2lx14ao1t3d4g.cloudfront.net/piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.go2linux.com/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->



        <!-- end analytics -->
    </body>
</html>
