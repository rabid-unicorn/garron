<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- SEO includes -->
        
<link href="/en/atom.xml" rel="alternate" title="Guillermo Garron" type="application/atom+xml" />


        <link rel="canonical" href="http://www.garron.me/en/linux/openvpn-server-client-linux-how-to.html" />
        
<meta name="robots" content="noodp, noydir" />


<meta name="description" content="Tutorial, to create a VPN using OpenVPN with Linux" />

        <!-- End SEO includes -->
        <title>How to create a VPN using OpenVPN and Linux</title>
        <!-- <link rel="stylesheet" href="/foundation/css/foundation.css" /> -->
        <link rel="stylesheet" href="//cdn.jsdelivr.net/foundation/5.5.1/css/foundation.min.css" />
        <link rel="stylesheet" href="/foundation/css/app.css">
        <link href='http://fonts.googleapis.com/css?family=Josefin+Slab|Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/webfonts/ss-social-circle.css" type="text/css">
        <!-- <link href="/bootstrap/css/magnific-popup.css" rel="stylesheet"> -->
        <link href="//cdn.jsdelivr.net/jquery.magnific-popup/1.0.0/magnific-popup.css" rel="stylesheet">
        <!-- Twitter cards -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@ggarron">
        <meta name="twitter:creator" content="@ggarron">
        <meta name="twitter:title" content="How to create a VPN using OpenVPN and Linux">
        <meta name="twitter:description" content="">
        <!-- End Twitter Cards -->
        <!-- FB property -->
        <meta property="fb:admins" content="613797474" />
        <!-- End FB Property -->
        <!-- <script src="/foundation/js/vendor/modernizr.js"></script> -->
        <script src="//cdn.jsdelivr.net/foundation/5.5.1/js/vendor/modernizr.js"></script>
    </head>
    <body>
        
        
        <div class="row">
    <div class="contain-to-grid sticky"> 
        <nav class="top-bar" data-topbar role="navigation" data-options="sticky_on: large">
            <ul class="title-area">
                <li class="name">
                    <h1><a href="/en/">Home</a></h1>
                </li>
                <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
            </ul>
            <section class="top-bar-section">
                <ul class="left">
                    <li><a href="/en/linux/">Linux</a></li>
                    <li><a href="/en/mac/">Mac</a></li>
                    <li><a href="/en/bits/">Tips</a></li>
                    <li><a href="/en/tech/">Tech</a></li>
                    <li><a href="/en/articles/">Articles</a></li>
                    <li><a href="/en/blog/">Blog</a></li>
                    <li><a href="/en/food/">Food</a></li>
                    <li><a href="/en/pictures/">Photos</a></li>
                    <li><a href="/en/projects/">Projects</a></li>
                    <li><a href="/en/web-design/">Web Designg</a></li>
                </ul>
            </section>
        </nav> 
    </div>
</div>
<div class="row">
    <div class="large-12 columns">
        <hr>
        <p>Get updates via: <a href="/en/atom.xml" class="ss-icon ss-social-circle">rss</a> | <a href="http://twitter.com/ggarron" class="ss-icon ss-social-circle">twitter</a> | <a href="http://feedburner.google.com/fb/a/mailverify?uri=GuillermoGarronMainSite&amp;loc=en_US" class="ss-icon ss-social-circle">email</a> | <a href="https://plus.google.com/u/0/115745027821234071812" class="ss-icon ss-social-circle">google+</a></p>
        <ul class="breadcrumbs">
            
            <li><a href="/index.html">Geeking</a>
            <li class="divider">&gt;</li>
            
            <li><a href="/en/index.html">Tech Blog</a>
            <li class="divider">&gt;</li>
            
            <li><a href="/en/linux/index.html">GNU Linux</a>
            <li class="divider">&gt;</li>
            
            <li class="active">How to create a VPN using OpenVPN and Linux</li>
        </ul>
    </div>
</div>
<div class="row">
    <div class="small-12 large-9 large-centered medium-9 medium-centered columns">
        <h3><a href="/en/linux/openvpn-server-client-linux-how-to.html">How to create a VPN using OpenVPN and Linux</a></h3>
<h6>Written by <a href="/en/about.html">Guillermo Garron</a> .</h6>
<h6>Date: 2012-01-07 08:33:00 -0500</h6>

<hr>
<p>Today I’ll write about OpenVPN, and how to establish a VPN between two computers.</p>

<h2 id="the-scenario">The scenario</h2>

<p>There are two offices.</p>

<ul>
  <li>The headquarters</li>
  <li>The branch office</li>
</ul>

<p>In this scenario the administrator wants all traffic of the branch office to be routed via the headquarters Internet router.  This can be desirable for example if you have your branch office in a country where you suspect the Internet provider or the government may be sniffing your traffic, or just because you want to have full control of the pages and sites the workers at the branch office can access.</p>

<p>In this scenario, we’ll establish the VPN over the Internet, so both the headquarters and the branch office should have their own access to Internet.</p>

<p>*Server info - At headquarters - *</p>

<ul>
  <li>Linux distribution: Arch Linux</li>
  <li>Public IP: 12.34.56.78</li>
</ul>

<p>*Client info - At the branch office - *</p>

<ul>
  <li>Linux distribution: Arch Linux</li>
  <li>Public IP: 23.45.67.89</li>
  <li>Private IP range: 10.1.0.0 / 255.255.0.0</li>
  <li>Private IP:	10.1.1.1</li>
</ul>

<h2 id="server-configuration">Server Configuration</h2>

<p>First we will install all needed software.</p>

<pre><code>pacman -S openvpn openssl
</code></pre>

<p>Now we need to create the server and client certificates, so the VPN can be encrypted.</p>

<pre><code>cd /usr/share/openvpn/easy-rsa/
</code></pre>

<p>Then set the variables:</p>

<pre><code>vim vars
</code></pre>

<p>Be sure to locate and set this values, here are the defaults, change accordingly.</p>

<pre>
export KEY_COUNTRY="US"
export KEY_PROVINCE="CA"
export KEY_CITY="SanFrancisco"
export KEY_ORG="Fort-Funston"
export KEY_EMAIL="me@myhost.mydomain"
export KEY_EMAIL=mail@host.domain
export KEY_CN=changeme
export KEY_NAME=changeme
export KEY_OU=changeme
export PKCS11_MODULE_PATH=changeme
export PKCS11_PIN=1234
</pre>

<p>Now run these commands</p>

<pre><code>. ./vars
</code></pre>

<p>Then</p>

<pre><code>./clean-all
</code></pre>

<p>then</p>

<pre><code>./build-ca
</code></pre>

<p>follow the instructions, and once finished create the server key</p>

<pre><code>./build-key-server server
</code></pre>

<p>Once again, follow the instructions and create the client key</p>

<pre><code>./build-key client1
</code></pre>

<p>Finally run:</p>

<pre><code>./build-dh
</code></pre>

<p>Now copy the the needed files to where the server is going to look for them:</p>

<pre><code>cp ca.crt /etc/openvpn/

cp server.crt /etc/openvpn/

cp dh1024.pem /etc/openvpn/

cp server.key /etc/openvpn/
</code></pre>

<p>Finally, let’s create the <code>/etc/openvpn/server.conf</code> file, here is an example:</p>

<pre>
port 1194
proto udp
dev tun
ca ca.crt
cert server.crt
key server.key  # This file should be kept secret
dh dh1024.pem
server 10.8.0.0 255.255.255.0
ifconfig-pool-persist ipp.txt
client-config-dir ccd
route 10.1.0.0 255.255.0.0
push "redirect-gateway def1"
keepalive 10 120
# Select a cryptographic cipher.
# This config item must be copied to
# the client config file as well.
;cipher BF-CBC        # Blowfish (default)
;cipher AES-128-CBC   # AES
;cipher DES-EDE3-CBC  # Triple-DES
comp-lzo
user nobody
group nobody
persist-key
persist-tun
status openvpn-status.log
verb 3
mute 20
</pre>

<p>This is a very simple example, you may want to check the example file and read the comments, it may be found at: <code>/usr/share/openvpn/examples/server.conf</code></p>

<h2 id="configure-the-client">Configure the client</h2>

<p>The client configuration, starts by copying the key and other files from the server. <code>ca.crt</code>, <code>client1.crt</code> and <code>client1.key</code>.</p>

<p>And finally create the configuration file, here is an example:</p>

<pre>
client

dev tun

proto udp

remote 23.45.67.89 1194
resolv-retry infinite

nobind

user nobody
group nobody

persist-key
persist-tun

ca ca.crt # Use full paths
cert home.crt # Use full paths
key home.key # Use full paths
comp-lzo
verb 3

mute 20
</pre>

<h2 id="start-the-vpn">Start the VPN</h2>

<p>First start the server side:</p>

<pre><code>openvpn /etc/openvpn/server.conf
</code></pre>

<p>Then the client side:</p>

<pre><code>openvpn /etc/openvpn/client.conf
</code></pre>

<p>If everything was OK, you should have the vpn up and working.</p>

<hr>
<a href="http://www.garron.me/en/linux/openvpn-server-client-linux-how-to.html">permalink</a>
<hr>
<p>If you enjoyed the article, please share it</a>
<p><a class="ss-icon ss-social-circle" href="http://twitter.com/intent/tweet?url=http://www.garron.me/en/linux/openvpn-server-client-linux-how-to.html&text=How to create a VPN using OpenVPN and Linux&via=ggarron">twitter</a> | <a class="ss-icon ss-social-circle" href="http://facebook.com/sharer.php?u=http://www.garron.me/en/linux/openvpn-server-client-linux-how-to.html">facebook</a> | <a class="ss-icon ss-social-circle" href="https://plus.google.com/share?url=http%3A%2F%2Fwww.garron.me/en/linux/openvpn-server-client-linux-how-to.html">google+</a> | <a class="ss-icon ss-social-circle" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.garron.me/en/linux/openvpn-server-client-linux-how-to.html">linkedin</a> | <a href="mailto:?Subject=How to create a VPN using OpenVPN and Linux&Body=http://www.garron.me/en/linux/openvpn-server-client-linux-how-to.html" class="ss-icon ss-social-circle">email</a> | <a href="http://reddit.com/submit?url=http://www.garron.me/en/linux/openvpn-server-client-linux-how-to.html&title=How to create a VPN using OpenVPN and Linux" class="ss-icon ss-social-circle">reddit</a></p>

<hr>
<h4>You may want to subscribe to my newsletter</h4>
<p>If you want to receive articles similar to this every month sign in to our Newsletter and joing other 2.000 readers</p>
<p>You can see an example of what is going to be sent to you <a href="/en/tag/tutorial.html">here</a></p>
<form class="all-centered" action="https://tinyletter.com/linux" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/linux', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true"><p><label for="tlemail">Please enter your email in the box below</label></p><p><input type="text" style="width:140px" name="email" id="tlemail" /></p><input type="hidden" value="1" name="embed"/><input type="submit" value="Subscribe" /><p><a href="https://tinyletter.com" target="_blank">powered by TinyLetter</a></p></form>


<hr>
<!-- <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'garronblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> -->


    </div>
</div>
      
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- <script src="/foundation/js/vendor/jquery.js"></script> -->
        <!-- <script src="/foundation/js/foundation.min.js"></script> -->
        <script src="//cdn.jsdelivr.net/foundation/5.5.1/js/foundation.min.js"></script>
        <!-- <script src="/foundation/js/rainbow.min.js"></script> -->
        <script src="//cdn.jsdelivr.net/rainbow/1.1.9/rainbow.min.js"></script>
        <!-- <script src="/bootstrap/js/magnific-popup.js"></script> -->
        <script src="//cdn.jsdelivr.net/jquery.magnific-popup/1.0.0/jquery.magnific-popup.min.js"></script>
        <!-- To start magnific popup -->
        <script src="/bootstrap/js/custom.js"></script>
        <script>
          $(document).foundation();
        </script>
        <!-- Analytics -->
        <!-- <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1514170-11']);
  _gaq.push(['_setDomainName', 'www.garron.me']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>    -->
        <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.go2linux.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src='http://d2lx14ao1t3d4g.cloudfront.net/piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.go2linux.com/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->



        <!-- end analytics -->
    </body>
</html>
