<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- SEO includes -->
        
<link href="/en/atom.xml" rel="alternate" title="Guillermo Garron" type="application/atom+xml" />


        <link rel="canonical" href="http://www.garron.me/en/go2linux/fail2ban-secure-linux.html" />
        
<meta name="robots" content="noopd, noydir" />


<meta name="description" content="Put brute force attackers away of your server with fail2ban" />

        <!-- End SEO includes -->
        <title>fail2ban - Free of dictionary attacks</title>
        <!-- <link rel="stylesheet" href="/foundation/css/foundation.css" /> -->
        <link rel="stylesheet" href="//cdn.jsdelivr.net/foundation/5.5.1/css/foundation.min.css" />
        <link rel="stylesheet" href="/foundation/css/app.css">
        <link href='http://fonts.googleapis.com/css?family=Josefin+Slab|Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/webfonts/ss-social-circle.css" type="text/css">
        <!-- <link href="/bootstrap/css/magnific-popup.css" rel="stylesheet"> -->
        <link href="//cdn.jsdelivr.net/jquery.magnific-popup/1.0.0/magnific-popup.css" rel="stylesheet">
        <!-- Twitter cards -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@ggarron">
        <meta name="twitter:creator" content="@ggarron">
        <meta name="twitter:title" content="fail2ban - Free of dictionary attacks">
        <meta name="twitter:description" content="Stay away from attackers to your Linux box using fail2ban">
        <!-- End Twitter Cards -->
        <!-- FB property -->
        <meta property="fb:admins" content="613797474" />
        <!-- End FB Property -->
        <!-- <script src="/foundation/js/vendor/modernizr.js"></script> -->
        <script src="//cdn.jsdelivr.net/foundation/5.5.1/js/vendor/modernizr.js"></script>
    </head>
    <body>
        
        
        <div class="row">
    <div class="contain-to-grid sticky"> 
        <nav class="top-bar" data-topbar role="navigation" data-options="sticky_on: large">
            <ul class="title-area">
                <li class="name">
                    <h1><a href="/en/">Home</a></h1>
                </li>
                <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
            </ul>
            <section class="top-bar-section">
                <ul class="left">
                    <li><a href="/en/linux/">Linux</a></li>
                    <li><a href="/en/mac/">Mac</a></li>
                    <li><a href="/en/bits/">Tips</a></li>
                    <li><a href="/en/tech/">Tech</a></li>
                    <li><a href="/en/articles/">Articles</a></li>
                    <li><a href="/en/blog/">Blog</a></li>
                    <li><a href="/en/food/">Food</a></li>
                    <li><a href="/en/pictures/">Photos</a></li>
                    <li><a href="/en/projects/">Projects</a></li>
                    <li><a href="/en/web-design/">Web Designg</a></li>
                </ul>
            </section>
        </nav> 
    </div>
</div>
<div class="row">
    <div class="large-12 columns">
        <hr>
        <p>Get updates via: <a href="/en/atom.xml" class="ss-icon ss-social-circle">rss</a> | <a href="http://twitter.com/ggarron" class="ss-icon ss-social-circle">twitter</a> | <a href="http://feedburner.google.com/fb/a/mailverify?uri=GuillermoGarronMainSite&amp;loc=en_US" class="ss-icon ss-social-circle">email</a> | <a href="https://plus.google.com/u/0/115745027821234071812" class="ss-icon ss-social-circle">google+</a></p>
        <ul class="breadcrumbs">
            
            <li><a href="/index.html">Geeking</a>
            <li class="divider">&gt;</li>
            
            <li><a href="/en/index.html">Tech Blog</a>
            <li class="divider">&gt;</li>
            
            <li><a href="/en/go2linux/index.html">Go2Linux</a>
            <li class="divider">&gt;</li>
            
            <li class="active">fail2ban - Free of dictionary attacks</li>
        </ul>
    </div>
</div>
<div class="row">
    <div class="small-12 large-9 large-centered medium-9 medium-centered columns">
        <h3><a href="/en/go2linux/fail2ban-secure-linux.html">fail2ban - Free of dictionary attacks</a></h3>
<h6>Written by <a href="/en/about.html">Guillermo Garron</a> .</h6>
<h6>Date: 2007-10-10 10:36:30 -0400</h6>

<hr>
<p>Starting this year I posted about <a href="/en/go2linux/denyhosts.html">DenyHosts</a>, which is a must have tool to avoid dictionary attacks to port 22 (ssh).</p>

<p>This kind of tools are really needed by sysadmins because the normal user refuse to make strong password, If the admin gives them a strong password, they will write it down, and then it stops being “strong”, If the admin tells the normal users, they need to remember their passwords and not to write them down, they will come with weak passwords like their son’s name, looking for new ways to secure the servers against dictionary attacks or brute force attacks, I have found this other tool that can do the job, I think this one is more flexible than DenyHosts, and also it works with Iptables. Well lets start, telling the options of fail2ban and its features.</p>

<p>It works by parsing logs files and thus finding failure attempts to log into the system, via a lot of possible protocols, and then acting to block the IP of the offending machine for the time you may configure, and using a lot of ways to achieve that.</p>

<p>It can block using:</p>

<ul>
  <li>Iptables</li>
  <li>shorewall</li>
  <li>Denyhost</li>
</ul>

<p>I will only talk here about Iptables which is the one I understand better.</p>

<p>fail2ban is actually two programs, a server and a client, while the server performs the actions of banning the IPs, the client is the one who reads the configurations files and parses the log files to instruct the server what to do.</p>

<h3 id="installing-it">Installing it</h3>

<p><strong>Debian / ubuntu</strong></p>

<pre><code>apt-get install fail2ban
</code></pre>

<p><strong>Gentoo / Sabayon</strong></p>

<pre><code>emerge fail2ban
</code></pre>

<h3 id="configuring-it">Configuring it</h3>

<p>Once installed there is the need of configuring it before making it run.</p>

<p>Fail2ban has two main configuration files called /etc/fail2ban/fail2ban.conf /etc/fail2ban/jail.com</p>

<p>Usually you will only need to change jail.conf</p>

<p>Jail.conf is divided by sections</p>

<p><strong>[default]</strong> Where all default options should go, all of them could be overwritten by the options written under the individual jails on this file</p>

<p>The options are:</p>

<p><strong>enabled</strong></p>

<p>Defines whether or not a given section is enabled or nor, its possible values are:</p>

<ul>
  <li>false</li>
  <li>true</li>
</ul>

<p><strong>filter</strong></p>

<p>This is not used in the default section as it is used to tell fail2ban client what it is looking for in the logfile, its values could be among others:</p>

<ul>
  <li>sshd</li>
  <li>proftpd</li>
  <li>httpd</li>
</ul>

<p>basically it is how the service is identified on the log file being parsed</p>

<p><strong>action</strong></p>

<p>This option tells fail2ban what action to take once a rule is broken, could be specified a default action in the default section, and overwritten on each jail section you may need to change the default value.</p>

<p><strong>logpath</strong></p>

<p>With this option we need to pass the file to be parsed, should be taken into account that different distribution has different log files for instance for ssh in:</p>

<ul>
  <li>Fedora -&gt; /var/log/secure</li>
  <li>CentOS -&gt; /var/log/secure</li>
  <li>Debian -&gt; /var/log/auth</li>
  <li>Ubuntu -&gt; /var/log/auth</li>
  <li>Sabayon -&gt; /var/log/messages</li>
</ul>

<p>If you put a wrong value here, it will not work and will give you no errors.</p>

<p><strong>ignoreip</strong></p>

<p>This option is used to set one or some IPs that should not be blocked, no matter how many times a users fail in login from those IPs, use this with care</p>

<p><strong>maxretry</strong></p>

<p>This option is used to set the limit of retries a user have before he gets blocked</p>

<p><strong>bantime</strong></p>

<p>This option is used to set the time (in seconds) an IP will be banned, maybe a good option could be 5 minutes so, 300 seconds, this will put bots away while also letting legitimate users to try again after the ban time ends</p>

<p><strong>destmail</strong></p>

<p>Use this option to set the email of the person who should receive alerts when an IP is banned</p>

<p><strong>banaction</strong></p>

<p>Use this option to instruct with action will be taking in order to ban an offending IP. ie:</p>

<ul>
  <li>iptables — To use Iptables in order to ban the offending IP</li>
  <li>iptables-new — To ban only new connections</li>
  <li>iptables-multiport — To ban all ports from the offending IP</li>
  <li>shorewall — To use Shorewall instead of Iptables</li>
</ul>

<p><strong>Protocol</strong></p>

<p>Set here the default protocol to ban, TCP or UDP
Lets put an example to secure ssh access. Example of /etc/fail2ban/fail2ban.conf</p>

<pre><code>[Definition]
loglevel = 3 # 1=Error, 2=Warn, 3=Info, 4=Debug
logtarget = /var/log/fail2ban.log
socket = /var/run/fail2ban.sock
</code></pre>

<p>Now lets go with the /etc/fail2ban/jail.conf</p>

<pre><code>[DEFAULT]

ignoreip = 127.0.0.1
bantime  = 600
maxretry = 3
backend = polling
destemail = root@localhost
banaction = iptables-multiport
mta = sendmail
protocol = tcp
action_ = %(banaction)s[name=%(__name__)s, port="%(port)s", protocol="%(protocol)s]
action_mw = %(banaction)s[name=%(__name__)s, port="%(port)s", protocol="%(protocol)s]
          %(mta)s-whois[name=%(__name__)s, dest="%(destemail)s", protocol="%(protocol)s]
# ban &amp; send an e-mail with whois report and relevant log lines
# to the destemail.
action_mwl = %(banaction)s[name=%(__name__)s, port="%(port)s", protocol="%(protocol)s]
           %(mta)s-whois-lines[name=%(__name__)s, dest="%(destemail)s", logpath=%(logpath)s]
action = %(action_)s

# JAILS
[ssh]
enabled = true
port	= ssh,sftp
filter	= sshd
logpath  = /var/log/auth.log
maxretry = 6

[apache]
enabled = false
port	= http,https
filter	= apache-auth
logpath = /var/log/apache*/*access.log
maxretry = 6
</code></pre>

<p>With these files we will have ssh enabled and secured, you see also here the configuration for apache, but it is disable. to turn the service on run:</p>

<pre><code>/etc/init.d/fail2ban start
</code></pre>


<hr>
<a href="http://www.garron.me/en/go2linux/fail2ban-secure-linux.html">permalink</a>
<hr>
<p>If you enjoyed the article, please share it</a>
<p><a class="ss-icon ss-social-circle" href="http://twitter.com/intent/tweet?url=http://www.garron.me/en/go2linux/fail2ban-secure-linux.html&text=fail2ban - Free of dictionary attacks&via=ggarron">twitter</a> | <a class="ss-icon ss-social-circle" href="http://facebook.com/sharer.php?u=http://www.garron.me/en/go2linux/fail2ban-secure-linux.html">facebook</a> | <a class="ss-icon ss-social-circle" href="https://plus.google.com/share?url=http%3A%2F%2Fwww.garron.me/en/go2linux/fail2ban-secure-linux.html">google+</a> | <a class="ss-icon ss-social-circle" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.garron.me/en/go2linux/fail2ban-secure-linux.html">linkedin</a> | <a href="mailto:?Subject=fail2ban - Free of dictionary attacks&Body=http://www.garron.me/en/go2linux/fail2ban-secure-linux.html" class="ss-icon ss-social-circle">email</a> | <a href="http://reddit.com/submit?url=http://www.garron.me/en/go2linux/fail2ban-secure-linux.html&title=fail2ban - Free of dictionary attacks" class="ss-icon ss-social-circle">reddit</a></p>

<hr>
<!-- <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'garronblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> -->


    </div>
</div>
      
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- <script src="/foundation/js/vendor/jquery.js"></script> -->
        <!-- <script src="/foundation/js/foundation.min.js"></script> -->
        <script src="//cdn.jsdelivr.net/foundation/5.5.1/js/foundation.min.js"></script>
        <!-- <script src="/foundation/js/rainbow.min.js"></script> -->
        <script src="//cdn.jsdelivr.net/rainbow/1.1.9/rainbow.min.js"></script>
        <!-- <script src="/bootstrap/js/magnific-popup.js"></script> -->
        <script src="//cdn.jsdelivr.net/jquery.magnific-popup/1.0.0/jquery.magnific-popup.min.js"></script>
        <!-- To start magnific popup -->
        <script src="/bootstrap/js/custom.js"></script>
        <script>
          $(document).foundation();
        </script>
        <!-- Analytics -->
        <!-- <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1514170-11']);
  _gaq.push(['_setDomainName', 'www.garron.me']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>    -->
        <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.go2linux.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src='http://d2lx14ao1t3d4g.cloudfront.net/piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.go2linux.com/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->



        <!-- end analytics -->
    </body>
</html>
