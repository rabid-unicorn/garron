<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- SEO includes -->
        
<link href="/en/atom.xml" rel="alternate" title="Guillermo Garron" type="application/atom+xml" />


        <link rel="canonical" href="http://www.garron.me/en/blog/ubuntu-lamp-apache2-mpm-worker-and-php-fpm.html" />
        
<meta name="robots" content="noodp, noydir" />


<meta name="description" content="How to install Apache2 MPM Worker and PHP-FPM on Ubuntu Server" />

        <!-- End SEO includes -->
        <title>Apache2 MPM Worker with PHP-FPM</title>
        <!-- <link rel="stylesheet" href="/foundation/css/foundation.css" /> -->
        <link rel="stylesheet" href="//cdn.jsdelivr.net/foundation/5.5.1/css/foundation.min.css" />
        <link rel="stylesheet" href="/foundation/css/app.css">
        <link href='http://fonts.googleapis.com/css?family=Josefin+Slab|Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/webfonts/ss-social-circle.css" type="text/css">
        <!-- <link href="/bootstrap/css/magnific-popup.css" rel="stylesheet"> -->
        <link href="//cdn.jsdelivr.net/jquery.magnific-popup/1.0.0/magnific-popup.css" rel="stylesheet">
        <!-- Twitter cards -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@ggarron">
        <meta name="twitter:creator" content="@ggarron">
        <meta name="twitter:title" content="Apache2 MPM Worker with PHP-FPM">
        <meta name="twitter:description" content="How to install Apache2 MPM Worker and PHP-FPM under Ubuntu server">
        <!-- End Twitter Cards -->
        <!-- FB property -->
        <meta property="fb:admins" content="613797474" />
        <!-- End FB Property -->
        <!-- <script src="/foundation/js/vendor/modernizr.js"></script> -->
        <script src="//cdn.jsdelivr.net/foundation/5.5.1/js/vendor/modernizr.js"></script>
    </head>
    <body>
        
        
        <div class="row">
    <div class="contain-to-grid sticky"> 
        <nav class="top-bar" data-topbar role="navigation" data-options="sticky_on: large">
            <ul class="title-area">
                <li class="name">
                    <h1><a href="/en/">Home</a></h1>
                </li>
                <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
            </ul>
            <section class="top-bar-section">
                <ul class="left">
                    <li><a href="/en/linux/">Linux</a></li>
                    <li><a href="/en/mac/">Mac</a></li>
                    <li><a href="/en/bits/">Tips</a></li>
                    <li><a href="/en/tech/">Tech</a></li>
                    <li><a href="/en/articles/">Articles</a></li>
                    <li><a href="/en/blog/">Blog</a></li>
                    <li><a href="/en/food/">Food</a></li>
                    <li><a href="/en/pictures/">Photos</a></li>
                    <li><a href="/en/projects/">Projects</a></li>
                    <li><a href="/en/web-design/">Web Designg</a></li>
                </ul>
            </section>
        </nav> 
    </div>
</div>
<div class="row">
    <div class="large-12 columns">
        <hr>
        <p>Get updates via: <a href="/en/atom.xml" class="ss-icon ss-social-circle">rss</a> | <a href="http://twitter.com/ggarron" class="ss-icon ss-social-circle">twitter</a> | <a href="http://feedburner.google.com/fb/a/mailverify?uri=GuillermoGarronMainSite&amp;loc=en_US" class="ss-icon ss-social-circle">email</a> | <a href="https://plus.google.com/u/0/115745027821234071812" class="ss-icon ss-social-circle">google+</a></p>
        <ul class="breadcrumbs">
            
            <li><a href="/index.html">Geeking</a>
            <li class="divider">&gt;</li>
            
            <li><a href="/en/index.html">Tech Blog</a>
            <li class="divider">&gt;</li>
            
            <li><a href="/en/blog/index.html">Personal</a>
            <li class="divider">&gt;</li>
            
            <li class="active">Apache2 MPM Worker with PHP-FPM</li>
        </ul>
    </div>
</div>
<div class="row">
    <div class="small-12 large-9 large-centered medium-9 medium-centered columns">
        <h3><a href="/en/blog/ubuntu-lamp-apache2-mpm-worker-and-php-fpm.html">Apache2 MPM Worker with PHP-FPM</a></h3>
<h6>Written by <a href="/en/about.html">Guillermo Garron</a> .</h6>
<h6>Date: 2012-12-26 10:13:00 -0500</h6>

        <hr>
        <p><small>Tags: <a href="/en/tag/tutorial.html">tutorial</a>,</small></p>

<hr>
<p><a href="/es/gnu-linux/apache-php-fpm-mpm-worker-mariadb-ubuntu.html">Spanish version</a></p>

<p>In the previous post I have talked about <a href="/en/blog/apache2-mpm-worker-prefork-php.html">Apache MPM worker and prefork mode</a></p>

<p>Today in this post I will show you how to install and configure a LAMP stack under Ubuntu using Apache MPM Worker instead of Prefork.</p>

<p>This is the list of what we are going to install</p>

<ul>
  <li>Apache 2.2 MPM Worker</li>
  <li>PHP-FPM</li>
  <li>MySQL server</li>
</ul>

<p>We will assume you already have an Ubuntu server running, in my case is an Ubuntu server version 12.10 running on a Linode VPS.</p>

<p><strong>Installing Apache</strong></p>

<p>If you install Apache alone, it seems that Ubuntu install the worker pre-build version by default. So this line should install Apache.</p>

<pre><code> sudo apt-get install apache2
</code></pre>

<p>Check that this package is being installed: <em>apache2-mpm-worker</em>. Or you can force Ubuntu to install it by running:</p>

<pre><code> sudo apt-get install apache2-mpm-worker
</code></pre>

<p><strong>Installing PHP</strong></p>

<pre><code> sudo apt-get install libapache2-mod-fastcgi php5-fpm php5 php5-curl php5-gd php5-imagick php-apc php5-mysql
</code></pre>

<p>This packages <em>php5-curl php5-gd php5-imagick php-apc</em> are needed to install Wordpress in the next post, if you do not need for your installation you can leave them out.</p>

<p>Enable Apache modules</p>

<pre><code> sudo a2enmod actions fastcgi alias
</code></pre>

<p>Restart Apache</p>

<pre><code> sudo service apache2 restart
</code></pre>

<p><strong>Installing MySQL</strong></p>

<pre><code> sudo apt-get install mysql-server mysql-client
</code></pre>

<p>We now have the LAMP stack installed, time to configure it.</p>

<p><strong>Configuring Apache to use PHP</strong></p>

<p>I am hosting static and dynamic sites on the same Apache server, because of that I am going to configure PHP in a per-virtual-site basis instead of having it configured system-wide. You can choose whatever method you prefer.</p>

<p><strong>PHP-FPM on Apache per Virtual Site</strong></p>

<p>Just edit the coresponding configuration file in <em>/etc/apache2/sites-enabled/</em> folder and add this line just before the closing <code>&lt;/VirtualHost&gt;</code> tag.</p>

<pre><code> &lt;IfModule mod_fastcgi.c&gt;
    AddHandler php5-fcgi .php
    Action php5-fcgi /php5-fcgi
    Alias /php5-fcgi /usr/lib/cgi-bin/php5-fcgi
    FastCgiExternalServer /usr/lib/cgi-bin/php5-fcgi -socket /var/run/php5-fpm.sock -pass-header Authorization
 &lt;/IfModule&gt;
</code></pre>

<p><strong>PHP-FPM on Apache system-wide</strong></p>

<p>To have PHP enabled for the whole server and all virtual sites, add the same above lines in a file in this folder <em>/etc/apache2/conf.d/</em>. You will need to create a file there named something like php-fpm.conf, anything you may want is good, as long as it has the .conf extension.</p>

<p><strong>Conclusion</strong></p>

<p>You now have a very efficient Apache server, capable to manage big loads of traffic to static files, and still able to manage PHP. Why not to use NGINX and PHP-FPM instead? That is up to you, I have gone this way because I wanted to be able to use .htaccess, and be able to follow standard instructions to install software like Wordpress, Wiki, Drupal and others, without the need to adapt everything to Nginx.</p>

<p>If you prefer NGINX is OK, I love NGINX too, and is the server I usually choose for my setups, I just like playing with other options.</p>

<p><strong>Final note</strong></p>

<p>In case you get errors while running PHP, check that this file <em>/etc/php5/fpm/pool.d/www.conf</em> Have this line:</p>

<pre><code> listen = /var/run/php5-fpm.sock
</code></pre>

<p>That is the default in Ubuntu 12.10, but may change in future versions.</p>

<hr>
<a href="http://www.garron.me/en/blog/ubuntu-lamp-apache2-mpm-worker-and-php-fpm.html">permalink</a>
<hr>
<p>If you enjoyed the article, please share it</a>
<p><a class="ss-icon ss-social-circle" href="http://twitter.com/intent/tweet?url=http://www.garron.me/en/blog/ubuntu-lamp-apache2-mpm-worker-and-php-fpm.html&text=Apache2 MPM Worker with PHP-FPM&via=ggarron">twitter</a> | <a class="ss-icon ss-social-circle" href="http://facebook.com/sharer.php?u=http://www.garron.me/en/blog/ubuntu-lamp-apache2-mpm-worker-and-php-fpm.html">facebook</a> | <a class="ss-icon ss-social-circle" href="https://plus.google.com/share?url=http%3A%2F%2Fwww.garron.me/en/blog/ubuntu-lamp-apache2-mpm-worker-and-php-fpm.html">google+</a> | <a class="ss-icon ss-social-circle" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.garron.me/en/blog/ubuntu-lamp-apache2-mpm-worker-and-php-fpm.html">linkedin</a> | <a href="mailto:?Subject=Apache2 MPM Worker with PHP-FPM&Body=http://www.garron.me/en/blog/ubuntu-lamp-apache2-mpm-worker-and-php-fpm.html" class="ss-icon ss-social-circle">email</a> | <a href="http://reddit.com/submit?url=http://www.garron.me/en/blog/ubuntu-lamp-apache2-mpm-worker-and-php-fpm.html&title=Apache2 MPM Worker with PHP-FPM" class="ss-icon ss-social-circle">reddit</a></p>

<hr>
<!-- <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'garronblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> -->


    </div>
</div>
      
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- <script src="/foundation/js/vendor/jquery.js"></script> -->
        <!-- <script src="/foundation/js/foundation.min.js"></script> -->
        <script src="//cdn.jsdelivr.net/foundation/5.5.1/js/foundation.min.js"></script>
        <!-- <script src="/foundation/js/rainbow.min.js"></script> -->
        <script src="//cdn.jsdelivr.net/rainbow/1.1.9/rainbow.min.js"></script>
        <!-- <script src="/bootstrap/js/magnific-popup.js"></script> -->
        <script src="//cdn.jsdelivr.net/jquery.magnific-popup/1.0.0/jquery.magnific-popup.min.js"></script>
        <!-- To start magnific popup -->
        <script src="/bootstrap/js/custom.js"></script>
        <script>
          $(document).foundation();
        </script>
        <!-- Analytics -->
        <!-- <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1514170-11']);
  _gaq.push(['_setDomainName', 'www.garron.me']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>    -->
        <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.go2linux.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src='http://d2lx14ao1t3d4g.cloudfront.net/piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.go2linux.com/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->



        <!-- end analytics -->
    </body>
</html>
