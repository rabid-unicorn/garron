<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- SEO includes -->
        
<link href="/en/atom.xml" rel="alternate" title="Guillermo Garron" type="application/atom+xml" />


        <link rel="canonical" href="http://www.garron.me/en/blog/ubuntu-deb-proxy-cache.html" />
        
<meta name="robots" content="noodp, noydir" />


<meta name="description" content="Save bandwidth with deb proxy and cache solutions for Ubuntu updates. squid-deb-proxy and apt-cacher-ng" />

        <!-- End SEO includes -->
        <title>Ubuntu deb proxy and cache: squid-deb-proxy and apt-cacher-ng</title>
        <!-- <link rel="stylesheet" href="/foundation/css/foundation.css" /> -->
        <link rel="stylesheet" href="//cdn.jsdelivr.net/foundation/5.5.1/css/foundation.min.css" />
        <link rel="stylesheet" href="/foundation/css/app.css">
        <link href='http://fonts.googleapis.com/css?family=Josefin+Slab|Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/webfonts/ss-social-circle.css" type="text/css">
        <!-- <link href="/bootstrap/css/magnific-popup.css" rel="stylesheet"> -->
        <link href="//cdn.jsdelivr.net/jquery.magnific-popup/1.0.0/magnific-popup.css" rel="stylesheet">
        <!-- Twitter cards -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@ggarron">
        <meta name="twitter:creator" content="@ggarron">
        <meta name="twitter:title" content="Ubuntu deb proxy and cache: squid-deb-proxy and apt-cacher-ng">
        <meta name="twitter:description" content="Save bandwidth with deb proxy and cache solutions for Ubuntu updates. squid-deb-proxy and apt-cacher-ng">
        <!-- End Twitter Cards -->
        <!-- FB property -->
        <meta property="fb:admins" content="613797474" />
        <!-- End FB Property -->
        <!-- <script src="/foundation/js/vendor/modernizr.js"></script> -->
        <script src="//cdn.jsdelivr.net/foundation/5.5.1/js/vendor/modernizr.js"></script>
    </head>
    <body>
        
        
        <div class="row">
    <div class="contain-to-grid sticky"> 
        <nav class="top-bar" data-topbar role="navigation" data-options="sticky_on: large">
            <ul class="title-area">
                <li class="name">
                    <h1><a href="/en/">Home</a></h1>
                </li>
                <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
            </ul>
            <section class="top-bar-section">
                <ul class="left">
                    <li><a href="/en/linux/">Linux</a></li>
                    <li><a href="/en/mac/">Mac</a></li>
                    <li><a href="/en/bits/">Tips</a></li>
                    <li><a href="/en/tech/">Tech</a></li>
                    <li><a href="/en/articles/">Articles</a></li>
                    <li><a href="/en/blog/">Blog</a></li>
                    <li><a href="/en/food/">Food</a></li>
                    <li><a href="/en/pictures/">Photos</a></li>
                    <li><a href="/en/projects/">Projects</a></li>
                    <li><a href="/en/web-design/">Web Designg</a></li>
                </ul>
            </section>
        </nav> 
    </div>
</div>
<div class="row">
    <div class="large-12 columns">
        <hr>
        <p>Get updates via: <a href="/en/atom.xml" class="ss-icon ss-social-circle">rss</a> | <a href="http://twitter.com/ggarron" class="ss-icon ss-social-circle">twitter</a> | <a href="http://feedburner.google.com/fb/a/mailverify?uri=GuillermoGarronMainSite&amp;loc=en_US" class="ss-icon ss-social-circle">email</a> | <a href="https://plus.google.com/u/0/115745027821234071812" class="ss-icon ss-social-circle">google+</a></p>
        <ul class="breadcrumbs">
            
            <li><a href="/index.html">Geeking</a>
            <li class="divider">&gt;</li>
            
            <li><a href="/en/index.html">Tech Blog</a>
            <li class="divider">&gt;</li>
            
            <li><a href="/en/blog/index.html">Personal</a>
            <li class="divider">&gt;</li>
            
            <li class="active">Ubuntu deb proxy and cache: squid-deb-proxy and apt-cacher-ng</li>
        </ul>
    </div>
</div>
<div class="row">
    <div class="small-12 large-9 large-centered medium-9 medium-centered columns">
        <h3><a href="/en/blog/ubuntu-deb-proxy-cache.html">Ubuntu deb proxy and cache: squid-deb-proxy and apt-cacher-ng</a></h3>
<h6>Written by <a href="/en/about.html">Guillermo Garron</a> .</h6>
<h6>Date: 2013-02-04 08:44:00 -0500</h6>

<hr>
<p>Ubuntu, Debian and all other Linux distributions use a lot of bandwidth by updating its packages. You can save both bandwidth and time by installing a proxy-cache that stores copies of downloaded packages and serves them locally to other computers when requested.</p>

<p>Actually any cache will do. The problem about using any cache system (like squid or polipo) is that them also cache other files and pages besides the Ubuntu deb packages. This makes easier for some package to be discarded from the cache and it may have to be downloaded again if you have a fast rotating cache, or if you do not have too much space on the cache.</p>

<p>The solution is to have a cache only for Ubuntu’s deb files.</p>

<p>There are a lot of options, but I have found two that seems to be the easiest and most easier to install and maintain, at least for me.</p>

<p><strong>squid-deb-proxy</strong></p>

<p>Squid-deb-proxy is as its name suggest, based on Squid, with a pre-defined configuration file and acl list to serve one specific purpose, which is cache deb files.</p>

<p>This is the easiest solution, and easiest to maintain and install, it requires no configuration on the client side, and almost or no configuration on the server side.</p>

<p><em>Install on the server</em></p>

<pre><code>sudo apt-get install squid-deb-proxy squid-dep-proxy-client
</code></pre>

<p><em>Install on clients</em></p>

<pre><code>sudo apt-get install squid-deb-proxy-client
</code></pre>

<p>If you are only using official repositories, there is nothing else to do, while on the same network all clients will look for a cache copy of the needed files. If there is no one, the server will fetch one from ubuntu servers and serve it to the client while keeping a copy for the next requirement.</p>

<p>If you need to use some other repository beside officials, you will need to edit the file <em>/etc/squid-deb-proxy/mirror-dstdomain.acl</em> and add them there. Other than that there is not need for further changes.</p>

<p>One pitfall I can see, is that there is no way to pre-populate the cache with deb files you may already have in a disk or your own PC in <em>/var/cache/apt/archives/</em>. And this is bad if you are behind a mobile or satellite connection.</p>

<p><strong>apt-cacher-ng</strong></p>

<p>apt-cacher-ng is a specialized tool.</p>

<blockquote>
  <p>“Specialized for package files from Linux distributors, primarily for Debian (and Debian based) distributions but not limited to those.”</p>
</blockquote>

<p>Of course as a Debian derivative it works great with Ubuntu. The installation is only performed on the server, and the configuration on the client.</p>

<p><em>Install on the server</em></p>

<pre><code>sudo apt-get install apt-cacher-ng
</code></pre>

<p>There is nothing else needed, and it should work from this point.</p>

<p><em>Configure de client</em></p>

<p>This configuration, should also be done on the server, so it can use the cache too.</p>

<p>Edit the file <em>/etc/apt/apt.conf</em> and add this lines::</p>

<pre><code>Acquire::http { Proxy "http://192.168.122.162:3142"; };
</code></pre>

<p>Replace 192.168.122.162 for the IP of your server.</p>

<p><em>Import the deb files you already have</em></p>

<p>To import the deb files to the cache, just copy all deb files you already have to <em>/var/cache/apt-cacher-ng/_import</em>, if it does not exists, you have to create it. Then go to: <em>http://192.168.122.162:3142/acng-report.html</em> (Change the IP for the IP of your server, look for the <em>Start Import</em> button, and click on it. Wait for some minutes and when it finished the job, you can delete the <em>_import</em> folder and all its contents.</p>

<p><strong>Conclusion</strong></p>

<p>Using the right tools, there is no need to waste bandwidth, If you have more than two computers, this kind of solution worth the time of setting it up, specially with desktop computers. With laptops it is a good idea too, and run upgrades when you are in the server’s network.</p>


<hr>
<a href="http://www.garron.me/en/blog/ubuntu-deb-proxy-cache.html">permalink</a>
<hr>
<p>If you enjoyed the article, please share it</a>
<p><a class="ss-icon ss-social-circle" href="http://twitter.com/intent/tweet?url=http://www.garron.me/en/blog/ubuntu-deb-proxy-cache.html&text=Ubuntu deb proxy and cache: squid-deb-proxy and apt-cacher-ng&via=ggarron">twitter</a> | <a class="ss-icon ss-social-circle" href="http://facebook.com/sharer.php?u=http://www.garron.me/en/blog/ubuntu-deb-proxy-cache.html">facebook</a> | <a class="ss-icon ss-social-circle" href="https://plus.google.com/share?url=http%3A%2F%2Fwww.garron.me/en/blog/ubuntu-deb-proxy-cache.html">google+</a> | <a class="ss-icon ss-social-circle" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.garron.me/en/blog/ubuntu-deb-proxy-cache.html">linkedin</a> | <a href="mailto:?Subject=Ubuntu deb proxy and cache: squid-deb-proxy and apt-cacher-ng&Body=http://www.garron.me/en/blog/ubuntu-deb-proxy-cache.html" class="ss-icon ss-social-circle">email</a> | <a href="http://reddit.com/submit?url=http://www.garron.me/en/blog/ubuntu-deb-proxy-cache.html&title=Ubuntu deb proxy and cache: squid-deb-proxy and apt-cacher-ng" class="ss-icon ss-social-circle">reddit</a></p>

<hr>
<!-- <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'garronblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> -->


    </div>
</div>
      
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- <script src="/foundation/js/vendor/jquery.js"></script> -->
        <!-- <script src="/foundation/js/foundation.min.js"></script> -->
        <script src="//cdn.jsdelivr.net/foundation/5.5.1/js/foundation.min.js"></script>
        <!-- <script src="/foundation/js/rainbow.min.js"></script> -->
        <script src="//cdn.jsdelivr.net/rainbow/1.1.9/rainbow.min.js"></script>
        <!-- <script src="/bootstrap/js/magnific-popup.js"></script> -->
        <script src="//cdn.jsdelivr.net/jquery.magnific-popup/1.0.0/jquery.magnific-popup.min.js"></script>
        <!-- To start magnific popup -->
        <script src="/bootstrap/js/custom.js"></script>
        <script>
          $(document).foundation();
        </script>
        <!-- Analytics -->
        <!-- <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1514170-11']);
  _gaq.push(['_setDomainName', 'www.garron.me']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>    -->
        <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.go2linux.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src='http://d2lx14ao1t3d4g.cloudfront.net/piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.go2linux.com/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->



        <!-- end analytics -->
    </body>
</html>
