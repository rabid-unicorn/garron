<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- SEO includes -->
        

<link href="/es/atom.xml" rel="alternate" title="Guillermo Garron" type="application/atom+xml" />

        <link rel="canonical" href="http://www.garron.me/es/gnu-linux/apache-event-php-fpm-mariadb-freebsd.html" />
        
<meta name="robots" content="noodp, noydir" />


<meta name="description" content="Cómo configurar un servidor FreeBSD con Apache MPM Evente, MariaDB y PHP-FPM, muy eficiente para alta demanda" />

        <!-- End SEO includes -->    
        <title>Apache, PHP, MySQL en FreeBSD</title>
        <!-- CSS -->
        <link href='http://fonts.googleapis.com/css?family=Josefin+Slab|Vollkorn|Old+Standard+TT|Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/webfonts/ss-social-circle.css" type="text/css">
        <!-- Bootstrap -->
        <link href="/bootstrap/css/bootstrap.journal.min.css" rel="stylesheet">
        <link href="/bootstrap/css/magnific-popup.css" rel="stylesheet">
        <!-- Custom Css -->
        <!-- <style>body {background-color: #FFFFFF;}

body,
input,
small,
button,
select,
textarea,
.navbar-search .search-query {
  font-family: "Source Sans Pro", "Vollkorn", Georgia, "Times New Roman", Times, serif; font-weight: 300; font-size: 18px; line-height: 26px; color: #404040;
}


h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: "Josefin Slab", Georgia, "Times New Roman", Times, serif; font-weight: 400; color: #101010;
}

.gallery-image-wrapper {
  height: 300px;
  width: 300px;
  display: inline-block;
  margin: 1em;
  position: relative;
  text-align: left;
}
.gallery-image {
  margin: auto;
  position: absolute;
  top: 0px;
  bottom: 0px;
  max-height: 100%;
  max-width: 100%;
}

#text-center {
text-align: center
}
</style> -->
        <!-- End custom css -->
        <!-- End CSS -->
        <!-- Twitter cards -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@ggarron">
        <meta name="twitter:creator" content="@ggarron">
        <meta name="twitter:title" content="Apache, PHP, MySQL en FreeBSD">
        <meta name="twitter:description" content="Cómo configurar un servidor FreeBSD con Apache MPM Evente, MariaDB y PHP-FPM, muy eficiente para alta demanda">
        <!-- End Twitter Cards -->
        <!-- FB property -->
        <meta property="fb:admins" content="613797474" />
        <!-- End FB Property -->
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>
            <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-static-top visible-xs visible-sm">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/es/"></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="/es/">Inicio</a></li>
            <li><a href="/es/gnu-linux/">Linux</a></li>
            <li><a href="/es/mac-os/">Mac</a></li>
            <li><a href="/es/cortos/">Tips</a></li>
            <li><a href="/es/articulos/">Artículos</a></li>
            <li><a href="/es/archivos.html">Archivos</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Personales <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="/es/bitacora/">Bitacora</a></li>
                <li><a href="/es/fotos/">Fotos</a></li>
                <li><a href="/es/recetas/">Comida</a></li>
              </ul>
            </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
<div class="container">
    <!-- Nav Bar -->
    <H1><a href="/es/">Guillermo Garron</a></h1>
<p>Suscribete: <a href="/es/atom.xml" class="ss-icon ss-social-circle">rss</a> | <a href="http://feedburner.google.com/fb/a/mailverify?uri=BitacoraGuillermo&amp;loc=en_US" class="ss-icon ss-social-circle">email</a></p>
<ol class="breadcrumb">

	<li><a href="/index.html">Geeking</a>
	<li class="divider">&gt;</li>

	<li><a href="/es/index.html">Tecnología</a>
	<li class="divider">&gt;</li>

	<li><a href="/es/gnu-linux/index.html">GNU Linux</a>
	<li class="divider">&gt;</li>

	<li class="active">Apache, PHP, MySQL en FreeBSD</li>
</ol>


    <!-- Nav Bar -->
    <div id="content" class="row">
        <div class="col-md-2 visible-lg visible-md">
            <h4>Categorias</h4>
<div class="well sidebar-nav">
  <ul class="nav nav-list">
    <li><h4>Tecnicas</h4></li>
    <li><a href="/es/gnu-linux/">Linux</a></li>
    <li><a href="/es/mac-os/">Mac</a></li>
    <li><a href="/es/cortos/">Tips</a></li>
    <li><a href="/es/articulos/">Artículos</a></li>
    <hr>
    <li><h4>Personales</h4></li>
    <li><a href="/es/bitacora/">Reflexiones</a></li>
    <li><a href="/es/fotos/">Fotos</a></li>
    <li><a href="/es/recetas/">Cocinando</a></li>
    <hr>
    <li><a href="/es/archivos.html">Archivos</a></li>
    <hr>
    <li><p><a href="/es/atom.xml" class="ss-icon ss-social-circle">rss</a> | <a href="http://feedburner.google.com/fb/a/mailverify?uri=BitacoraGuillermo&amp;loc=en_US" class="ss-icon ss-social-circle">email</a></p></li>
  </ul>
</div>

        </div>
        <div class="col-md-7">
            <h3><a href="/es/gnu-linux/apache-event-php-fpm-mariadb-freebsd.html">Apache, PHP, MySQL en FreeBSD</a></h3>
<h6>Escrito por: <a href="/es/acerca-de.html">Guillermo Garron</a> .</h6>
<h6>Fecha: 2015-02-01 15:05:00 -0500</h6>
<hr>
<h3 id="introduccin">Introducción</h3>

<p>Siempre me gustó el estilo BSD de Slackware, y ahora que <a href="https://www.digitalocean.com/?refcode=e00a30198abe">Digital Ocean</a> ofrece FreeBSD, estoy aprovechando para pasar un rato trabajando con él.</p>

<p>Hoy vamos a ver como instalar y configurar Apache 2.4, MariaDB y PHP en FreeBSD 10, vamos a optimizarlo para que puede soportar carga sin requerir grandes prestaciones del servidor. Lo lograremos configurando de la siguiente manera:</p>

<ul>
  <li>Apache Event MPM (trabaja de la misma forma que Nginx, por lo que es muy eficiente)</li>
  <li>PHP-FPM, PHP es un servicio independiente de Apache, lo que hace que solo sea invocado cuando se requiere y no para servir contenido estático.</li>
  <li>MariaDB, que deriva de MySQL, manteniendo total compatibilidad con esta última, pero agregando mejoras que MySQL no posee.</li>
</ul>

<h3 id="apache-24-event-mpm">Apache 2.4 Event MPM</h3>

<p>Vamos primero con Apache, como dije antes, vamos a instalarlo compilandolo para usar MPM Event, que funciona mucho más rápido que el prefork que usa por defecto.</p>

<pre><code>cd /usr/ports/www/apache24/
make install clean
</code></pre>

<p>Asegurate de seleccionar estos módulos a la hora de compilar.</p>

<pre><code>| [x] ACCESS_COMPAT      mod_access compatibility
| [x] ACTIONS            Action triggering on requests 
| [x] ALIAS              Mapping of requests to different filesystem parts
| [x] AUTHZ_CORE         Core authorization provider vector module
| [x] AUTHZ_HOST         Host-based authorization control
| [x] DIR                Directory request handling
|+[x] EXPIRES            Expires header control
|+[x] HEADERS            HTTP header control
|+[x] REWRITE            Rule based URL manipulation
|+[x] VERSION            Determining httpd version in config files
|+[x] VHOST_ALIAS        Mass virtual hosting
|+(*) MPM_EVENT          MPM worker variant with the goal of consuming
| [x] MIME               Mapp file-ext. to MIME (recommended)
| [x] PROXY              Build enabled PROXY modules
| [x] PROXY_FCGI         FastCGI support module for mod_proxy
</code></pre>

<p>A mi personalmente me gusta tener los servidores virtuales en archivos separados, al estilo de Ubuntu, y no como parte de un monolítico archivo <code>httpd.conf</code>, para ello vamos a hacer lo siguiente.</p>

<pre><code>mkdir /usr/local/etc/apache24/conf.d
</code></pre>

<p>Agrega esta línea al final del archivo <code>/usr/local/etc/apache24/httpd.conf</code></p>

<pre><code>Include etc/apache24/conf.d/*.conf
</code></pre>

<h3 id="php-56">PHP 5.6</h3>

<p>Ahora es el turno de PHP, vamos a compilar con la opción PHP-FPM encendida.</p>

<pre><code>cd /usr/ports/lang/php56

make install
</code></pre>

<p>Y seleccionamos lo siguiente.</p>

<pre><code>|+[x] CLI       Build CLI version
|+[x] CGI       Build CGI version
|+[x] FPM       Build FPM version
|+[ ] EMBED     Build embedded library
|+[ ] PHPDBG
|+[ ] DEBUG     Enable debug
|+[ ] DTRACE    Enable DTrace support
|+[x] IPV6      Enable ipv6 support
|+[ ] MAILHEAD  Enable mail header patch
|+[x] LINKTHR   Link thread lib (for threaded extensions)
|+[ ] ZTS       Force Zend Thread Safety (ZTS) build
</code></pre>

<p>Finalmente limpiamos el disco.</p>

<pre><code>make clean
</code></pre>

<p>Ahora tenemos PHP 5.6 instalado, pero requerimos ciertos módulos tambien, así que:</p>

<pre><code>cd ../php56-extensions/

make install clean
</code></pre>

<p>Asegúrate de marcar GD, CURL y MySQL así como también MySQLi</p>

<pre><code>|+[x] CURL          CURL support
|+[x] GD            GD library support
|+[x] MYSQL         MySQL database support
|+[x] MYSQLI        MySQLi database support
</code></pre>

<p>Estos además de los que están marcados por defecto.</p>

<h3 id="mariadb-100">MariaDB 10.0</h3>

<p>Es el turno de MariaDB, el cual instalaremos en lugar de MySQL</p>

<p>En su <a href="http://mariadb.com">sitio</a> oficial dice:</p>

<blockquote>
  <p>MariaDB 10.0 es actualmente la versión estable de MariaDB. Esta basada en MariaDB 5.5 y mantiene características de MySQL 5.6 además de características que no se encuentran en ningún otro lado.</p>
</blockquote>

<p>Para instalarlo ejecutamos:</p>

<pre><code>cd /usr/ports/databases/mariadb100-server

make install clean
</code></pre>

<p>Y dejamos todas las opciones por defecto, luego aseguramos la instalación y ejecutamos:</p>

<pre><code>mysql_secure_installation
</code></pre>

<p>Donde te pregunten por la contraseña, coloca una buena contraseña difícil de adivinar. Y luego acepta todas las opciones por defecto.</p>

<h3 id="finalizando-la-instalacin">Finalizando la instalación</h3>

<p><strong>Preparando los servicios para ejecutarse</strong></p>

<p>Requerimos ahora configurar todos los servicios para que arranquen al reiniciar el servidor, para ello es necesario editar el achivo <code>/etc/rc.conf</code> y adicionar estas líneas.</p>

<pre><code>apache24_enable="YES"
php_fpm_enable="YES"
mysql_enable="YES"
</code></pre>

<p>Es necesario un paso más para Apache. Edita el archivo <code>/usr/local/etc/apache24/httpd.conf</code> y agrega esta línea justo antes de <em>Include….</em></p>

<pre><code>ServerName localhost
</code></pre>

<p>Asegurate que estos módulos esten activos, esto lo haces verificando estas líneas en el archivo <code>/usr/local/etc/apache24/httpd.conf</code></p>

<pre><code>LoadModule authn_core_module libexec/apache24/mod_authn_core.so
LoadModule authz_core_module libexec/apache24/mod_authz_core.so
LoadModule log_config_module libexec/apache24/mod_log_config.so
LoadModule expires_module libexec/apache24/mod_expires.so
LoadModule headers_module libexec/apache24/mod_headers.so
LoadModule version_module libexec/apache24/mod_version.so
LoadModule unixd_module libexec/apache24/mod_unixd.so
LoadModule vhost_alias_module libexec/apache24/mod_vhost_alias.so
LoadModule dir_module libexec/apache24/mod_dir.so
LoadModule rewrite_module libexec/apache24/mod_rewrite.so
LoadModule mime_module  libexec/apache24/mod_mime.so
LoadModule actions_module libexec/apache24/mod_actions.so
LoadModule alias_module libexec/apache24/mod_alias.so
LoadModule authz_host_module libexec/apache24/mod_authz_host.so
LoadModule access_compat_module libexec/apache24/mod_access_compat.so
LoadModule proxy_module libexec/apache24/mod_proxy.so
LoadModule proxy_fcgi_module libexec/apache24/mod_proxy_fcgi.so
</code></pre>

<p>Y finalmente arrancamos los servicios.</p>

<pre><code>service apache24 start
service mysql-server start
service php-fpm start
</code></pre>

<h3 id="probando-la-instalacin">Probando la instalación</h3>

<p>Vamos a crear un sitio de prueba para asegurarnos que todo funcione.</p>

<p><strong>Crea un directorio para tu sitio de pruebas</strong></p>

<pre><code>mkdir -p /usr/local/www/site1/{public_html,logs}
chown -R www:www /usr/local/www/site1/
</code></pre>

<p><strong>Configura el host virtual</strong></p>

<p>Crea el archivo <code>/usr/local/etc/apache24/conf.d/site1.conf</code>, le puedes llamar como gustes, y coloca este contenido en su interior:</p>

<pre><code>    &lt;VirtualHost *:80&gt;
        ServerAdmin webmaster@example.com
        DocumentRoot "/usr/local/www/site1/public_html"
        ServerName freebsd.garron.me
        ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/usr/local/www/site1/public_html/$1
        ErrorLog "/usr/local/www/site1/logs/error.log"
        CustomLog "/usr/local/www/site1/logs/access.log" common
        ScriptAlias /cgi-bin/ "/usr/local/www/site1/cgi-bin/"

    &lt;Directory "/usr/local/www/site1/public_html"&gt;
        Options +Indexes +FollowSymLinks +ExecCGI
        AllowOverride AuthConfig FileInfo
        Require all granted
        Allow from all
    &lt;/Directory&gt;

&lt;/VirtualHost&gt;
</code></pre>

<p><strong>Comprueba la configuración</strong></p>

<p>Necesitamos crear un archivo llamado <code>phpinfo.php</code> con este contenido:</p>

<pre><code>&lt;?php
    phpinfo();
?&gt;
</code></pre>

<p>Una vez guardado, podemos ir a http://freebsd.garron.me/phpinfo.php, (esto solo en este caso) y la información de PHP debe aparecer. Esta línea es importante.</p>

<pre><code>Server API 	FPM/FastCGI 
</code></pre>

<p>Nos muestra que estamos corriendo PHP como un servicio independiente llamado PHP-FPM, además deberíamos verificar el MPM de Apache.</p>

<pre><code>httpd -V | grep MPM
</code></pre>

<p>La respuestas debe ser:</p>

<pre><code>Server MPM:     event
</code></pre>

<hr>
En Categoria: <strong><a href="/es/gnu-linux/">es|gnu-linux</a></strong> | <a href="http://www.garron.me/es/gnu-linux/apache-event-php-fpm-mariadb-freebsd.html">permalink</a>
<hr>
<p>Si te gusto el artículo, por favor compartelo</p>
<p><a class="ss-icon ss-social-circle" href="http://twitter.com/intent/tweet?url=http://www.garron.me/es/gnu-linux/apache-event-php-fpm-mariadb-freebsd.html&text=Apache, PHP, MySQL en FreeBSD&via=ggarron">twitter</a> | <a class="ss-icon ss-social-circle" href="http://facebook.com/sharer.php?u=http://www.garron.me/es/gnu-linux/apache-event-php-fpm-mariadb-freebsd.html">facebook</a> | <a class="ss-icon ss-social-circle" href="https://plus.google.com/share?url=http%3A%2F%2Fwww.garron.me/es/gnu-linux/apache-event-php-fpm-mariadb-freebsd.html">google+</a> | <a class="ss-icon ss-social-circle" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.garron.me/es/gnu-linux/apache-event-php-fpm-mariadb-freebsd.html">linkedin</a> | <a href="mailto:?Subject=Apache, PHP, MySQL en FreeBSD&Body=http://www.garron.me/es/gnu-linux/apache-event-php-fpm-mariadb-freebsd.html" class="ss-icon ss-social-circle">email</a> | <a href="http://reddit.com/submit?url=http://www.garron.me/es/gnu-linux/apache-event-php-fpm-mariadb-freebsd.html&title=Apache, PHP, MySQL en FreeBSD" class="ss-icon ss-social-circle">reddit</a></p>
<hr>
<div id="discourse-comments"></div>

<script type="text/javascript">
  var discourseUrl = "http://discusion.detecnologia.org/",
      discourseEmbedUrl = 'http://www.garron.me/es/gnu-linux/apache-event-php-fpm-mariadb-freebsd.html';

  (function() {
    var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
      d.src = discourseUrl + 'javascripts/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
  })();
</script>



<hr>

        </div>
        <div class="col-md-3">
            <!-- Esta es la columna derecha que debe estar vacía por ahora -->
        </div>
    </div>
</div>

        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="/bootstrap/js/bootstrap.min.js"></script>
        <script src="/bootstrap/js/magnific-popup.js"></script>
        <script src="/bootstrap/js/custom.js"></script>
        <!-- Analytics -->
        <!-- <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1514170-11']);
  _gaq.push(['_setDomainName', 'www.garron.me']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>    -->
        <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.go2linux.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src='http://d2lx14ao1t3d4g.cloudfront.net/piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.go2linux.com/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->



        <!-- end analytics -->
    </body>
</html>
